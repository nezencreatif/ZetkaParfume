// --- DATABASE ---
const products = [
    { id: 'm1', name: "ZETKA ALPHA", segment: "man", desc: "Dominasi dalam botol. Oud & Leather.", stats: { longevity: 90, sillage: 80, unique: 70 }, zkReason: "Aura Alpha. Base notes Leather sangat dominan.", tags: ["woody", "leather"] },
    { id: 'm2', name: "BLUE HORIZON", segment: "man", desc: "Kesegaran laut & Citrus.", stats: { longevity: 60, sillage: 70, unique: 50 }, zkReason: "Mood booster instan untuk produktivitas.", tags: ["fresh", "citrus"] },
    { id: 'w1', name: "VELVET ROSE", segment: "woman", desc: "Mawar hitam & Vanilla.", stats: { longevity: 85, sillage: 90, unique: 80 }, zkReason: "Kombinasi Seductive. Sangat memikat.", tags: ["floral", "sweet"] },
    { id: 'w2', name: "PURE BLANC", segment: "woman", desc: "Clean Laundry & Musk.", stats: { longevity: 50, sillage: 40, unique: 60 }, zkReason: "Kesan bersih dan profesional.", tags: ["fresh", "clean"] },
    { id: 's1', name: "NEON DUST", segment: "street", desc: "Aspal basah & Mint.", stats: { longevity: 70, sillage: 80, unique: 95 }, zkReason: "Futuristik & Niche.", tags: ["edgy", "metallic"] },
    { id: 's2', name: "GLITCH POP", segment: "street", desc: "Permen karet & Asap.", stats: { longevity: 80, sillage: 85, unique: 90 }, zkReason: "Playful tapi berbahaya.", tags: ["sweet", "party"] }
];

// Map segment ke Index (0, 1, 2) biar tau arah geser
const segIndex = { 'man': 0, 'woman': 1, 'street': 2 };

const app = {
    currentSeg: 'man',
    isAnimating: false,

    init: () => {
        // Load Theme
        if(localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-theme');
            document.getElementById('theme-icon').classList.replace('ph-moon', 'ph-sun');
        }
        
        setTimeout(() => document.getElementById('loader').style.display = 'none', 1500);
        app.renderContent('man', false); // Render awal tanpa animasi
    },

    setSegment: (newSeg) => {
        if (app.currentSeg === newSeg || app.isAnimating) return;
        app.isAnimating = true;

        // Tentukan Arah: 
        // Kalau Index Baru > Index Lama = Geser ke KIRI (Konten masuk dari Kanan)
        // Kalau Index Baru < Index Lama = Geser ke KANAN (Konten masuk dari Kiri)
        const direction = segIndex[newSeg] > segIndex[app.currentSeg] ? 'next' : 'prev';
        const wrapper = document.getElementById('content-wrapper');

        // 1. Animasi Keluar (Slide Out)
        const outClass = direction === 'next' ? 'slide-out-left' : 'slide-out-right';
        wrapper.classList.add('flow-animate', outClass);

        // 2. Tunggu animasi selesai, baru ganti konten
        setTimeout(() => {
            app.currentSeg = newSeg;
            
            // Update Tombol Navigasi
            document.querySelectorAll('.segment-control button').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${newSeg}`).classList.add('active');
            
            // Update Tema Warna
            document.body.className = `theme-${newSeg} ${localStorage.getItem('theme') === 'light' ? 'light-theme' : ''}`;

            // Reset Animasi Class
            wrapper.classList.remove(outClass);
            
            // Render Konten Baru
            app.renderContent(newSeg, true);

            // 3. Animasi Masuk (Slide In)
            const inClass = direction === 'next' ? 'slide-in-right' : 'slide-in-left';
            wrapper.classList.add(inClass);

            // Bersihkan class setelah animasi masuk selesai
            setTimeout(() => {
                wrapper.classList.remove('flow-animate', inClass);
                app.isAnimating = false;
            }, 500);

        }, 400); // Waktu animasi keluar (sesuai CSS 0.4s-0.5s)
    },

    renderContent: (seg, animateItems) => {
        // Update Hero Text
        const textMap = {
            man: { t: "PROFESSIONAL<br>COLLECTION", d: "Curated for the modern gentleman." },
            woman: { t: "ELEGANCE<br>REDEFINED", d: "Scent that whispers class." },
            street: { t: "URBAN<br>GLITCH_MODE", d: "Break the rules. Smell distinct." }
        };
        document.getElementById('hero-title').innerHTML = textMap[seg].t;
        document.getElementById('hero-desc').innerText = textMap[seg].d;

        // Render Grid
        const grid = document.getElementById('grid-container');
        grid.innerHTML = '';
        
        const filtered = products.filter(p => p.segment === seg);
        filtered.forEach((p, idx) => {
            const card = document.createElement('div');
            card.className = 'product-card';
            if(animateItems) card.style.animationDelay = `${idx * 0.1}s`; // Stagger delay
            if(animateItems) card.classList.add('stagger-item');
            
            card.innerHTML = `
                <div class="card-img" style="background-image: url('assets/prod-${p.id}.jpg')"></div>
                <div class="card-meta"><h3>${p.name}</h3><p>${p.desc}</p></div>
            `;
            card.onclick = () => ui.openModal(p);
            grid.appendChild(card);
        });

        zk.resetChat();
    }
};

const ui = {
    toggleTheme: () => {
        const body = document.body;
        body.classList.toggle('light-theme');
        const isLight = body.classList.contains('light-theme');
        const icon = document.getElementById('theme-icon');
        
        if(isLight) {
            icon.classList.replace('ph-moon', 'ph-sun');
            localStorage.setItem('theme', 'light');
        } else {
            icon.classList.replace('ph-sun', 'ph-moon');
            localStorage.setItem('theme', 'dark');
        }
        // Force re-apply segment theme color fix
        body.className = `theme-${app.currentSeg} ${isLight ? 'light-theme' : ''}`;
    },
    toggleMenu: () => document.getElementById('main-menu').classList.toggle('active'),
    openModal: (p) => {
        document.getElementById('modal-name').innerText = p.name;
        document.getElementById('modal-desc').innerText = p.desc;
        document.getElementById('modal-seg-tag').innerText = p.segment.toUpperCase();
        document.getElementById('modal-zk-note').innerText = p.zkReason;
        
        ['long','sillage','unique'].forEach(k => document.getElementById(`bar-${k}`).style.width = '0%');
        document.getElementById('product-modal').style.display = 'flex';
        
        setTimeout(() => {
            document.getElementById('bar-long').style.width = p.stats.longevity + '%';
            document.getElementById('bar-sillage').style.width = p.stats.sillage + '%';
            document.getElementById('bar-unique').style.width = p.stats.unique + '%';
            document.getElementById('val-long').innerText = p.stats.longevity + '/100';
            document.getElementById('val-sillage').innerText = p.stats.sillage + '/100';
            document.getElementById('val-unique').innerText = p.stats.unique + '%';
        }, 100);
    },
    closeModal: () => document.getElementById('product-modal').style.display = 'none'
};

const zk = {
    isOpen: false,
    toggle: () => {
        zk.isOpen = !zk.isOpen;
        document.getElementById('zk-interface').classList.toggle('active', zk.isOpen);
    },
    resetChat: () => {
        const log = document.getElementById('zk-chat-log');
        log.innerHTML = '';
        const intro = app.currentSeg === 'street' ? "Yo. Street mode on." : 
                      app.currentSeg === 'man' ? "Hello Sir. Professional assistance ready." :
                      "Hello Miss. Looking for elegance?";
        zk.addBubble(intro, 'bot');
    },
    addBubble: (text, type) => {
        const log = document.getElementById('zk-chat-log');
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.style.padding = "8px 12px"; div.style.marginBottom="10px"; div.style.borderRadius="8px";
        div.style.background = type === 'bot' ? "#333" : "var(--accent)";
        div.style.color = type === 'bot' ? "#fff" : "#000";
        div.innerHTML = text;
        log.appendChild(div);
    },
    handleEnter: (e) => { if(e.key === 'Enter') zk.sendMessage(); },
    sendMessage: () => {
        const input = document.getElementById('user-input');
        if(!input.value) return;
        zk.addBubble(input.value, 'user');
        setTimeout(() => zk.addBubble("Saya merekomendasikan ZETKA ALPHA.", 'bot'), 1000);
        input.value = '';
    }
};

app.init();
